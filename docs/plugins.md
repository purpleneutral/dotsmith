# Plugin Management

dotsmith includes built-in plugin management for **zsh** and **tmux**. A plugin is just a git repo with a file to source -- no framework needed.

Inspired by [zsh_unplugged](https://github.com/mattmc3/zsh_unplugged): clone, detect the init file, generate a loader, done.

## Quick Start

```sh
# Add plugins using GitHub shorthand
dotsmith plugins zsh add zsh-users/zsh-autosuggestions
dotsmith plugins tmux add tmux-plugins/tmux-sensible

# Then add ONE line to your config file:
#   source ~/.config/dotsmith/plugins/zsh/loader.zsh      (in .zshrc)
#   source-file ~/.config/dotsmith/plugins/tmux/loader.conf  (in tmux.conf)
```

## Supported Tools

Plugin management is available for **zsh** and **tmux** only. These are the two tools where sourcing plugins from git repos is a standard pattern.

Other tools that have plugin systems (neovim with lazy.nvim, etc.) are detected by dotsmith but managed by their native plugin managers. dotsmith tracks the config files; the tool's own manager handles the plugins.

## Adding Plugins

```sh
dotsmith plugins <tool> add <repo>
```

The repo specifier accepts:

| Format | Example |
|--------|---------|
| GitHub shorthand | `zsh-users/zsh-autosuggestions` |
| Full HTTPS URL | `https://github.com/user/repo` |
| Full URL with `.git` | `https://github.com/user/repo.git` |

### What Happens

1. **Clone** -- `git clone --depth 1` into `~/.config/dotsmith/plugins/<tool>/<name>/`
2. **Detect init file** -- finds the file to source (see below)
3. **Register** -- adds the plugin to `manifest.toml` with repo, init file, and timestamp
4. **Regenerate loader** -- updates the loader file with an entry for the new plugin

### Init File Detection

**Zsh** (checked in order):
1. `*.plugin.zsh` (first alphabetically if multiple)
2. `*.zsh-theme`
3. `init.zsh`
4. Single `*.zsh` file (fails if multiple without a clear match)

**Tmux:**
- Any `*.tmux` file (first alphabetically)

If no init file is detected, the clone is removed and an error is returned.

## Setting Up the Loader

After adding your first plugin, source the generated loader file from your config:

**Zsh** -- add to `.zshrc`:
```sh
source ~/.config/dotsmith/plugins/zsh/loader.zsh
```

**Tmux** -- add to `tmux.conf`:
```
source-file ~/.config/dotsmith/plugins/tmux/loader.conf
```

The loader file is regenerated automatically whenever you add or remove a plugin. You only need to add this line once.

### Loader Format

The zsh loader sources each plugin's init file:
```sh
# Generated by dotsmith -- do not edit
source ~/.config/dotsmith/plugins/zsh/zsh-autosuggestions/zsh-autosuggestions.plugin.zsh
source ~/.config/dotsmith/plugins/zsh/zsh-syntax-highlighting/zsh-syntax-highlighting.plugin.zsh
```

The tmux loader uses `run-shell`:
```
# Generated by dotsmith -- do not edit
run-shell ~/.config/dotsmith/plugins/tmux/tmux-sensible/sensible.tmux
run-shell ~/.config/dotsmith/plugins/tmux/tmux-resurrect/resurrect.tmux
```

## Managing Plugins

### List

```sh
dotsmith plugins zsh list
```

Shows all installed plugins with their repository and init file.

### Update

```sh
dotsmith plugins zsh update                        # update all
dotsmith plugins zsh update zsh-autosuggestions     # update one
```

Runs `git pull --ff-only` in each plugin directory. Shows old and new commit hashes for updated plugins. For zsh plugins, `.zwc` compiled files are regenerated if present.

### Remove

```sh
dotsmith plugins zsh remove zsh-autosuggestions
```

Removes the plugin directory and its entry from the manifest. The loader file is regenerated.

## Plugin Info

dotsmith can scan installed plugins and extract information from their README files.

### CLI

```sh
dotsmith plugins zsh info                          # all plugins
dotsmith plugins zsh info zsh-autosuggestions       # specific plugin
```

Displays:
- Plugin name, repository, URL
- Description (first paragraph from README)
- Configuration excerpt (from "Configuration", "Options", or "Usage" sections)

### TUI

In the plugins view, press `i` to toggle a split info panel. The left side shows the plugin list; the right side shows details for the selected plugin including description, URL, and config excerpt.

## Curated Plugin Options

In addition to scanning installed plugins, dotsmith ships with curated option databases for popular plugins. These appear in the explore view and CLI search.

### tmux Plugins (24 options)

| Plugin | Options | Description |
|--------|---------|-------------|
| [tmux-resurrect](https://github.com/tmux-plugins/tmux-resurrect) | 6 | Save and restore tmux sessions |
| [tmux-continuum](https://github.com/tmux-plugins/tmux-continuum) | 4 | Automatic session saving and restore on boot |
| [tmux-yank](https://github.com/tmux-plugins/tmux-yank) | 3 | Copy to system clipboard |
| [catppuccin/tmux](https://github.com/catppuccin/tmux) | 3 | Catppuccin color theme |
| [tmux-prefix-highlight](https://github.com/tmux-plugins/tmux-prefix-highlight) | 4 | Highlight prefix key in status bar |
| [tmux-fingers](https://github.com/Morantron/tmux-fingers) | 3 | Quick copy with hints |
| [tmux-sensible](https://github.com/tmux-plugins/tmux-sensible) | 1 | Universal defaults |

### zsh Plugins (28 options)

| Plugin | Options | Description |
|--------|---------|-------------|
| [zsh-autosuggestions](https://github.com/zsh-users/zsh-autosuggestions) | 4 | Fish-like autosuggestions |
| [zsh-syntax-highlighting](https://github.com/zsh-users/zsh-syntax-highlighting) | 3 | Fish-like syntax highlighting |
| [zsh-history-substring-search](https://github.com/zsh-users/zsh-history-substring-search) | 4 | History search by substring |
| [fzf-tab](https://github.com/Aloxaf/fzf-tab) | 3 | fzf-powered tab completion |
| [powerlevel10k](https://github.com/romkatv/powerlevel10k) | 4 | Fast, flexible prompt theme |
| [zoxide](https://github.com/ajeetdsouza/zoxide) | 5 | Smarter cd command |
| [fzf](https://github.com/junegunn/fzf) | 5 | Fuzzy finder integration |

These options show up in `dotsmith explore` under `plugin:*` categories and in `dotsmith search` results with links to documentation.

## Coexistence with Existing Managers

When you run `dotsmith add`, it detects existing plugin managers:

- **TPM** (tmux Plugin Manager)
- **zinit**, **oh-my-zsh**, **zsh_unplugged** (zsh)
- **lazy.nvim** (neovim)

These are noted in the manifest but never replaced or modified. dotsmith plugin management is opt-in -- you explicitly choose to use it by running `dotsmith plugins <tool> add`.

If you already use TPM or zinit and are happy with them, there's no need to switch. dotsmith will track your config files and let you explore options regardless.

## See Also

- [Command Reference](commands.md#plugins) -- all plugin commands
- [TUI Guide](tui.md#plugins-view) -- TUI plugin management
- [Supported Tools](supported-tools.md) -- which tools support plugins
